### 中级工程师面试答案

#### 1 读写分离怎么保证数据一致性，主从延迟等问题

- java中有用切面的方式，注解。切面的方式去判断哪些sql读从库或者哪些走主库
- 或者从应用的角度去判断，去区分哪些走从库，哪些走主库

### 2 sql写入数据的时候，什么时候比较慢

- 构建索引的过程
- 答id自增问题，因为数据是b+树存储，会有页分裂，数据会变的碎片化，如果不自增

### 3 分布式事务失败的处理

- 

### 4 计算密集型，cpu设置

- 如果有超线程，设置为cpu核心数两倍大小

### 5 es和mongodb的区别

- es本身是基于搜索引擎去做的，更擅长做全文匹配，复杂的一些搜索，索引。以为里头是一些倒排索引，分词的能力是很强的，但是写入的支持并不是很好，弱一致性的。
- mongo底层是B树，支持事务

### 6 分布式场景，缓存一致性问题

### 7 zookeeper主动推拉

cp，牺牲了可用性，但其实并不是真正的强一致性，顺序一致性。zk写入是过半机制，如果没入的数据还是老的数据，那么就可能调用到已经下线的机器

### 8 具体io模型的阐述

io模型大致分为阻塞、非阻塞、同步、异步。一个就是内核态到用户态的过程去描述，磁盘和内核态的一个传输，每种模型比较适合于哪个场景。0拷贝技术、内核态用户态的区分

### 9 什么是羊群效应或者鲸群效应

线上机器很多，每次部署的时候，会有少量的请求会报超时。即下游的应用在部署，上游的请求会报通道关闭的错误。报服务通道关闭的时候，类似ddos攻击，sync攻击。因为服务器三次握手中，第一次握手中，会进入半连接队列，如果半连接队列满了，只需要修改linux的backlog参数即可。 半连接队列也叫syn队列。全连接队列也叫accpect队列(https://www.cnblogs.com/xiaolincoding/p/12995358.html)

![半连接队列与全连接队列](https://cdn.jsdelivr.net/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/TCP-%E5%8D%8A%E8%BF%9E%E6%8E%A5%E5%92%8C%E5%85%A8%E8%BF%9E%E6%8E%A5/3.jpg)



### 10 系统的稳定性，怎么去做优化的

缓存，集群，消息等 限流 降级 垄断 水平扩展等每个项目的性能瓶颈一般都不大一样吧

### 数据库跟缓存的一致性问题
